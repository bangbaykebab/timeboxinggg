<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0A84FF">
  <title>Time Boxing Checklist (PWA)</title>

  <!-- Link manifest (create file manifest.json with content provided below) -->
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">

  <style>
    /* Basic iOS-like modern design */
    :root{
      --bg: #f6f7fb;
      --card:#ffffff;
      --accent:#0A84FF; /* iOS blue */
      --muted:#8893a7;
      --radius:14px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#0b1320}
    .app{min-height:100vh;display:flex;flex-direction:column}
    header{padding:18px 18px 6px}
    .title{font-size:20px;font-weight:600}
    main{flex:1;padding:0 16px 80px}

    /* Cards */
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 18px rgba(12,22,40,0.06);padding:12px;margin-bottom:12px}

    /* Forms */
    .row{display:flex;gap:8px}
    select,input[type=number],textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e9f2;font-size:14px}
    label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
    button{background:var(--accent);color:white;padding:10px 14px;border-radius:12px;border:0;font-weight:600}
    button.secondary{background:transparent;color:var(--accent);border:1px solid rgba(10,132,255,0.12)}

    /* Checklist list */
    .checklist-item{display:flex;align-items:center;gap:12px;padding:10px 6px;border-radius:10px}
    .checklist-list{display:flex;flex-direction:column;gap:6px}

    /* Bottom nav */
    .bottom-nav{position:fixed;left:8px;right:8px;bottom:12px;height:62px;background:rgba(255,255,255,0.9);border-radius:22px;display:flex;justify-content:space-around;align-items:center;box-shadow:0 10px 30px rgba(11,19,32,0.08)}
    .tab{flex:1;text-align:center;padding:6px 8px;border-radius:16px;color:var(--muted);font-weight:600}
    .tab.active{color:var(--accent)}

    /* Table for rekap */
    .table{width:100%;border-collapse:collapse;font-size:13px}
    .table th,.table td{padding:8px;border-bottom:1px solid #f1f3f8;text-align:left}
    .table th{color:var(--muted);font-weight:600}

    /* Journal cards */
    .journal-card{padding:12px;margin-bottom:10px;border-radius:12px}
    .journal-meta{font-size:12px;color:var(--muted);margin-bottom:6px}

    /* Small screens spacing */
    @media(min-width:600px){main{max-width:720px;margin:0 auto}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">Time Boxing Checklist</div>
      <div style="font-size:12px;color:var(--muted);">Simple PWA — data saved to localStorage</div>
    </header>

    <main>
      <!-- Checklist Page -->
      <section id="page-checklist" class="page">
        <div class="card">
          <label>Pilih Tanggal</label>
          <div class="row">
            <select id="cb-day"></select>
            <select id="cb-month"></select>
            <select id="cb-year"></select>
            <button id="btn-show">Tampilkan</button>
          </div>
        </div>

        <div id="checklist-area" style="display:none">
          <div class="card">
            <div class="checklist-list" id="checklist-list"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button id="btn-save-checklist">Simpan</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Rekap Page -->
      <section id="page-rekap" class="page" style="display:none">
        <div class="card">
          <label>Pilih Bulan & Tahun</label>
          <div class="row">
            <select id="re-month"></select>
            <select id="re-year"></select>
            <button id="btn-rekap-show">Tampilkan</button>
            <button id="btn-rekap-refresh" class="secondary">Refresh</button>
          </div>
        </div>
        <div id="rekap-table-area" style="display:none">
          <div class="card" style="overflow:auto">
            <table class="table" id="rekap-table">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Sholat Subuh</th>
                  <th>Sholat Duha</th>
                  <th>Istighfar 500x</th>
                  <th>Push Up 50x</th>
                  <th>Podcast</th>
                  <th>Hafalan 5</th>
                  <th>Persen</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Jurnal Page -->
      <section id="page-jurnal" class="page" style="display:none">
        <div class="card">
          <label>Pilih Tanggal</label>
          <div class="row">
            <select id="j-day"></select>
            <select id="j-month"></select>
            <select id="j-year"></select>
            <button id="btn-j-show">Tampilkan</button>
          </div>
        </div>

        <div id="jurnal-area" style="display:none">
          <div class="card">
            <label>Hal-hal yang perlu dicatat hari ini</label>
            <textarea id="note-today" rows="4"></textarea>
            <label style="margin-top:8px">Apa yang akan dilakukan besok</label>
            <textarea id="note-tomorrow" rows="3"></textarea>
            <div style="display:flex;justify-content:flex-end;margin-top:8px">
              <button id="btn-save-journal">Simpan</button>
            </div>
          </div>
          <div id="journal-list"></div>
        </div>
      </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" role="navigation">
      <div class="tab active" data-target="page-checklist">Checklist</div>
      <div class="tab" data-target="page-rekap">Rekap</div>
      <div class="tab" data-target="page-jurnal">Jurnal</div>
    </nav>
  </div>

  <script>
    /* ========= Static checklist items ========= */
    const CHECK_ITEMS = [
      { key: 'subuh', label: 'Sholat Subuh tepat waktu' },
      { key: 'duha', label: 'Sholat Duha' },
      { key: 'istighfar', label: 'Istighfar 500x' },
      { key: 'pushup', label: 'Push Up 50x' },
      { key: 'podcast', label: 'Mendengarkan podcast min 1 video' },
      { key: 'hafal', label: 'Menghafal 5 kalimat bahasa inggris' }
    ];

    /* ======= Utilities for date and localStorage keys ======== */
    function pad(n){return n<10? '0'+n: ''+n}
    function ymdKey(y,m,d){return `${y}-${pad(m)}-${pad(d)}`}
    function checklistKey(ymd){return `checklist_${ymd}`}
    function journalKey(ymd){return `journal_${ymd}`}

    /* ======== Populate select elements ======= */
    function populateDaySelect(sel){sel.innerHTML='';for(let i=1;i<=31;i++){let o=document.createElement('option');o.value=i;o.text=i;sel.appendChild(o)}}
    function populateMonthSelect(sel){sel.innerHTML='';for(let i=1;i<=12;i++){let o=document.createElement('option');o.value=i;o.text=i;sel.appendChild(o)}}
    function populateYearSelect(sel,range=5){
      sel.innerHTML='';const now=new Date();const start=now.getFullYear()-range;for(let y=start;y<=now.getFullYear()+1;y++){let o=document.createElement('option');o.value=y;o.text=y;sel.appendChild(o)}}

    // On load
    document.addEventListener('DOMContentLoaded',()=>{
      // checklist selects
      populateDaySelect(document.getElementById('cb-day'))
      populateMonthSelect(document.getElementById('cb-month'))
      populateYearSelect(document.getElementById('cb-year'))

      // jurnal selects (separate DOM nodes but same values)
      populateDaySelect(document.getElementById('j-day'))
      populateMonthSelect(document.getElementById('j-month'))
      populateYearSelect(document.getElementById('j-year'))

      // rekap selects
      populateMonthSelect(document.getElementById('re-month'))
      populateYearSelect(document.getElementById('re-year'))

      // set today's date as default
      const now=new Date();
      document.getElementById('cb-day').value=now.getDate();
      document.getElementById('cb-month').value=now.getMonth()+1;
      document.getElementById('cb-year').value=now.getFullYear();

      document.getElementById('j-day').value=now.getDate();
      document.getElementById('j-month').value=now.getMonth()+1;
      document.getElementById('j-year').value=now.getFullYear();

      document.getElementById('re-month').value=now.getMonth()+1;
      document.getElementById('re-year').value=now.getFullYear();

      // Init tabs
      initTabs()

      // Button handlers
      document.getElementById('btn-show').addEventListener('click', showChecklistForSelectedDate)
      document.getElementById('btn-save-checklist').addEventListener('click', saveChecklist)

      document.getElementById('btn-rekap-show').addEventListener('click', showRekap)
      document.getElementById('btn-rekap-refresh').addEventListener('click', showRekap)

      document.getElementById('btn-j-show').addEventListener('click', showJournalForSelectedDate)
      document.getElementById('btn-save-journal').addEventListener('click', saveJournalEntry)

      // Load journal list initially
      renderJournalList()

      // Register service worker for PWA
      if('serviceWorker' in navigator){
        navigator.serviceWorker.register('/service-worker.js').catch(err=>console.log('SW register failed',err))
      }
    })

    /* ======= Tab navigation ======= */
    function initTabs(){
      document.querySelectorAll('.bottom-nav .tab').forEach(tab=>{
        tab.addEventListener('click',()=>{
          document.querySelectorAll('.bottom-nav .tab').forEach(t=>t.classList.remove('active'))
          tab.classList.add('active')
          document.querySelectorAll('main .page').forEach(p=>p.style.display='none')
          document.getElementById(tab.dataset.target).style.display='block'
          // If showing rekap, refresh table
          if(tab.dataset.target==='page-rekap'){ document.getElementById('btn-rekap-show').click() }
        })
      })
    }

    /* ===== Checklist logic ===== */
    function showChecklistForSelectedDate(){
      const d = +document.getElementById('cb-day').value
      const m = +document.getElementById('cb-month').value
      const y = +document.getElementById('cb-year').value
      const ymd = ymdKey(y,m,d)
      const key = checklistKey(ymd)
      const saved = localStorage.getItem(key)
      const data = saved ? JSON.parse(saved) : {}

      const container = document.getElementById('checklist-list')
      container.innerHTML = ''
      CHECK_ITEMS.forEach(item=>{
        const row = document.createElement('div')
        row.className='checklist-item'
        const input = document.createElement('input')
        input.type='checkbox'
        input.id = 'cb_'+item.key
        input.checked = !!data[item.key]
        const label = document.createElement('label')
        label.htmlFor = input.id
        label.textContent = item.label
        row.appendChild(input)
        row.appendChild(label)
        container.appendChild(row)
      })

      document.getElementById('checklist-area').style.display='block'
    }

    function saveChecklist(){
      const d = +document.getElementById('cb-day').value
      const m = +document.getElementById('cb-month').value
      const y = +document.getElementById('cb-year').value
      const ymd = ymdKey(y,m,d)
      const key = checklistKey(ymd)
      const payload = {}
      CHECK_ITEMS.forEach(item=>{
        const el = document.getElementById('cb_'+item.key)
        payload[item.key] = !!el && el.checked
      })
      payload._savedAt = new Date().toISOString()
      localStorage.setItem(key, JSON.stringify(payload))
      alert('Checklist disimpan untuk ' + ymd)
    }

    /* ===== Rekap logic ===== */
    function showRekap(){
      const m = +document.getElementById('re-month').value
      const y = +document.getElementById('re-year').value
      const tbody = document.querySelector('#rekap-table tbody')
      tbody.innerHTML = ''

      // loop days in month
      const daysInMonth = new Date(y, m, 0).getDate()
      for(let d=1; d<=daysInMonth; d++){
        const ymd = ymdKey(y,m,d)
        const key = checklistKey(ymd)
        const saved = localStorage.getItem(key)
        const row = document.createElement('tr')

        const tdDate = document.createElement('td')
        tdDate.textContent = ymd
        row.appendChild(tdDate)

        let completedCount = 0
        const total = CHECK_ITEMS.length

        if(saved){
          const data = JSON.parse(saved)
          CHECK_ITEMS.forEach(item=>{
            const td = document.createElement('td')
            const val = !!data[item.key]
            td.textContent = val ? '✓' : ''
            row.appendChild(td)
            if(val) completedCount++
          })
        } else {
          // not saved, show empty cells
          for(let i=0;i<total;i++){const td=document.createElement('td');td.textContent='';row.appendChild(td)}
        }

        // persen
        const tdPercent = document.createElement('td')
        const percent = Math.round((completedCount/total)*100)
        tdPercent.textContent = percent + '%'
        row.appendChild(tdPercent)

        tbody.appendChild(row)
      }

      document.getElementById('rekap-table-area').style.display = 'block'
    }

    /* ===== Journal logic ===== */
    function showJournalForSelectedDate(){
      const d = +document.getElementById('j-day').value
      const m = +document.getElementById('j-month').value
      const y = +document.getElementById('j-year').value
      const ymd = ymdKey(y,m,d)
      const key = journalKey(ymd)
      const saved = localStorage.getItem(key)
      if(saved){
        const data = JSON.parse(saved)
        document.getElementById('note-today').value = data.today || ''
        document.getElementById('note-tomorrow').value = data.tomorrow || ''
      } else {
        document.getElementById('note-today').value = ''
        document.getElementById('note-tomorrow').value = ''
      }
      document.getElementById('jurnal-area').style.display='block'
    }

    function saveJournalEntry(){
      const d = +document.getElementById('j-day').value
      const m = +document.getElementById('j-month').value
      const y = +document.getElementById('j-year').value
      const ymd = ymdKey(y,m,d)
      const key = journalKey(ymd)
      const payload = {
        today: document.getElementById('note-today').value.trim(),
        tomorrow: document.getElementById('note-tomorrow').value.trim(),
        _savedAt: new Date().toISOString(),
        _ymd: ymd
      }
      localStorage.setItem(key, JSON.stringify(payload))
      alert('Jurnal disimpan untuk ' + ymd)
      renderJournalList()
    }

    function renderJournalList(){
      // collect all keys that start with journal_
      const list = []
      for(let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i)
        if(k && k.indexOf('journal_')===0){
          try{
            const data = JSON.parse(localStorage.getItem(k))
            list.push({key:k,data})
          }catch(e){console.warn('invalid journal',k)}
        }
      }
      // sort by savedAt desc
      list.sort((a,b)=>{
        const ta = a.data._savedAt || '1970'
        const tb = b.data._savedAt || '1970'
        return tb.localeCompare(ta)
      })

      const container = document.getElementById('journal-list')
      container.innerHTML=''
      list.forEach(item=>{
        const card = document.createElement('div')
        card.className='card journal-card'
        const meta = document.createElement('div')
        meta.className='journal-meta'
        meta.textContent = item.data._ymd + ' — ' + (new Date(item.data._savedAt).toLocaleString())
        card.appendChild(meta)

        const t = document.createElement('div')
        t.innerHTML = `<strong>Hari ini</strong><p>${escapeHtml(item.data.today || '')}</p><strong>Besok</strong><p>${escapeHtml(item.data.tomorrow || '')}</p>`
        card.appendChild(t)

        const editBtn = document.createElement('button')
        editBtn.className='secondary'
        editBtn.style.marginTop='8px'
        editBtn.textContent='Edit'
        editBtn.addEventListener('click',()=>{
          // load into jurnal form for editing
          const parts = item.key.split('_')
          const ymd = parts[1]
          const [y,m,d] = ymd.split('-')
          document.getElementById('j-year').value = y
          document.getElementById('j-month').value = +m
          document.getElementById('j-day').value = +d
          showJournalForSelectedDate()
          document.getElementById('note-today').value = item.data.today || ''
          document.getElementById('note-tomorrow').value = item.data.tomorrow || ''
        })

        card.appendChild(editBtn)
        container.appendChild(card)
      })
    }

    function escapeHtml(s){
      if(!s) return ''
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>')
    }

  </script>
</body>
</html>
